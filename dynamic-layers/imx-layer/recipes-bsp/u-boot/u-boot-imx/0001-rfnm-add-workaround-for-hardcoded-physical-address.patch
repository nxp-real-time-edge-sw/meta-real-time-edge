From 87ff6ba00e3859f4d2d9893fe3159cc6158e996e Mon Sep 17 00:00:00 2001
From: Pramod Kumar <pramod.kumar_1@nxp.com>
Date: Fri, 23 Feb 2024 12:24:20 +0530
Subject: [PATCH] rfnm: add workaround for hardcoded physical address

Signed-off-by: Pramod Kumar <pramod.kumar_1@nxp.com>
---
 board/freescale/imx8mp_rfnm/imx8mp_rfnm.c |  2 +-
 board/freescale/imx8mp_rfnm/rfnm-shared.h | 34 +++++++++++++++++++++++
 2 files changed, 35 insertions(+), 1 deletion(-)
 create mode 100644 board/freescale/imx8mp_rfnm/rfnm-shared.h

diff --git a/board/freescale/imx8mp_rfnm/imx8mp_rfnm.c b/board/freescale/imx8mp_rfnm/imx8mp_rfnm.c
index 2463a4e00c..69b666a05b 100644
--- a/board/freescale/imx8mp_rfnm/imx8mp_rfnm.c
+++ b/board/freescale/imx8mp_rfnm/imx8mp_rfnm.c
@@ -29,7 +29,7 @@
 #include <imx_sip.h>
 #include <linux/arm-smccc.h>
 #include <mmc.h>
-#include <../../../../../../../../work-shared/imx8mp-rfnm/kernel-source/include/linux/rfnm-shared.h>
+#include "rfnm-shared.h"
 
 DECLARE_GLOBAL_DATA_PTR;
 
diff --git a/board/freescale/imx8mp_rfnm/rfnm-shared.h b/board/freescale/imx8mp_rfnm/rfnm-shared.h
new file mode 100644
index 0000000000..c673f9b84f
--- /dev/null
+++ b/board/freescale/imx8mp_rfnm/rfnm-shared.h
@@ -0,0 +1,34 @@
+#ifndef INCLUDE_LINUX_RFNM_SHARED_H_
+#define INCLUDE_LINUX_RFNM_SHARED_H_
+
+#define RFNM_DAUGHTERBOARD_BREAKOUT (1)
+#define RFNM_DAUGHTERBOARD_GRANITA (2)
+#define RFNM_DAUGHTERBOARD_LIME (3)
+
+#define RFNM_DAUGHTERBOARD_PRESENT (0x10)
+#define RFNM_DAUGHTERBOARD_NOT_FOUND (0x20)
+#define RFNM_DAUGHTERBOARD_NOT_CHECKED_YET (0xff)
+
+#define RFNM_BOOTCONFIG_PHYADDR (0xA3400000)
+
+
+struct __packed rfnm_eeprom_data {
+	uint8_t magic_header[4];
+	uint8_t pad1[12];
+	uint8_t board_id;
+	uint8_t board_revision_id;
+	uint8_t pad2[5];
+	uint8_t serial_number[9];
+	uint32_t crc;
+};
+
+// 0xff initial status is only guaranteed by uboot mod in the first 4kB
+struct __packed rfnm_bootconfig {
+	uint8_t daughterboard_present[2];
+	uint8_t pcie_clock_ready;
+	uint8_t usb_pd_negotiation_in_progress;
+	struct rfnm_eeprom_data motherboard_eeprom;
+	struct rfnm_eeprom_data daughterboard_eeprom[2];
+};
+
+#endif
-- 
2.25.1

